<section id="map">
   <div class="map_container">
      <div id="map3" class="map-intern display_none display_nonet"></div>
    </div>

    <script type="text/javascript">  
        handler = Gmaps.build('Google');
        handler.buildMap({ provider: {}, internal: {id: 'map3'}}, function(){
          markers = handler.addMarkers(<%=raw @pins.to_json %>);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
        });

    </script>
</section>

<%= render 'partials/main_nav' %>
<section class="notivication">
   <p id="notice"><%= notice %></p>
</section>

<section class="container">
   <header>
      <h2 class="intern-head"> <%= t"internships.details" %></h2>
   </header>
   <section class="internship">
      <section class="internDetail">
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.title" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.title %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.orientation" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.orientation.try(:name) %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.programming_languages" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.programming_languages.map(&:name).join(", ") %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.salary" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.salary %> €/<%= t("unit.month")%>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.working_hours" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.working_hours %>/<%= t("unit.week")%>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.living_costs" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.living_costs %> €/<%= t("unit.month")%>
            </div>
         </article>
      </section>
      <!---->
      <section class="company">
         <header>
            <h3>Company</h3>
         </header>
         <article class="row" id="row2-intern">
            <% if  @company.website %>
               <div class="span3" id="intern-title">
                  <%= t "companies.attributes.name"  %>
               </div>
               <div class="span8" id="intern-box">
                  <%= link_to @company.name, url_with_protocol(@company.website) , target: "_blank" if @company.website %>
               </div>
            <% else %>
               <div class="span3" id="intern-title">
                  <%= t "companies.attributes.name"  %>
               </div>
               <div class="span8" id="intern-box">
                  <%= @company.name %>
               </div>
            <% end %>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "companies.attributes.industry"  %>
            </div>
            <div class="span8" id="intern-box">
               <%= @company.industry %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "companies.attributes.number_employees"  %>
            </div>
            <div class="span8" id="intern-box">
               <%= @company.number_employees %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "companies.attributes.main_language"  %>
            </div>
            <div class="span8" id="intern-box">
               <%= @company.main_language %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "companies.attributes.rating"  %>
            </div>
            <div class="span8" id="intern-box">
               <%= render_stars(@company.average_rating,self) %>
            </div>
         </article>
         <!---->
         <% if @other_internships.any? %>
            <article class="row" id="row2-intern">   
               <div id="company-title">
                  <%= t("internships.others")  %>
               </div>
               <br/>
               <div id="company-title-text">
                  <% @other_internships.each do |other| %> 
                     <div>
                        <%= link_to " #{other.title}", other, class: "btn btn-success icon-white icon-circle-arrow-right icon-large" %>
                     </div>
                     <br/>
                  <% end %>        
               </div>
            </article>
         <% end %>
         <!---->
      </section>
      <!---->
      <section class="ratings">
         <header>
            <h2>Ratings</h2>
         </header>
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.tasks_rating" %>
            </div>
            <div class="span8" style="padding-top:7px">
               <%= render_stars @internship.internship_rating.tasks, self %>
            <div class="span8">
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.training_rating" %>
            </div>
            <div class="span8" style="padding-top:7px">
               <%= render_stars @internship.internship_rating.training_success, self %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.atmosphere_rating" %>
            </div>
            <div class="span8" style="padding-top:7px">
               <%= render_stars @internship.internship_rating.atmosphere, self %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.supervision_rating" %>
            </div>
            <div class="span8" style="padding-top:7px">
               <%= render_stars @internship.internship_rating.supervision, self %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.appreciation_rating" %>
            </div>
            <div class="span8" style="padding-top:7px">
               <%= render_stars @internship.internship_rating.appreciation,self %>
            </div>
         </article>
      </section>
      <!---->
      <section class="student">
         <article class="row" id="row2-intern"> 
            <header>
               <h2>Student</h2>
            </header>
            <% if @internship.student.try(:user).try(:publicmail) %>
              
               <div class="span3" id="intern-title">
                  <%= t "users.attributes.email" %>
               </div>
               <div class="span8" id="intern-box">
                  <%= mail_to @internship.student.user.email, @internship.try(:student).try(:name) %>
               </div>
            <% else %>   
               <div class="span3" id="intern-title">
                  <%= t "internships.attributes.student" %>
               </div>
               <div class="span8" id="intern-box">
                  <%= @internship.try(:student).try(:name) %>
               </div>
            <% end %>
         </article>
         <!---->      
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.semester" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.semester.name %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.recommend" %>
            </div>
            <div class="span8" id="intern-box">
               <% if @internship.recommend %>
                  <i class="icon-thumbs-up icon-2x green-thumb"></i>
               <% else %>
                  <i class="icon-thumbs-down icon-2x red-thumb"></i>
               <% end %>
            </div>
         </article>
         <!---->
         <article class="row" id="row2-intern">   
            <div class="span3" id="intern-title">
               <%= t "internships.attributes.description" %>
            </div>
            <div class="span8" id="intern-box">
               <%= @internship.description %>
            </div>
         </article>
      </section>
      <section class="favourite">
         <div id="favorite">
            <% if @favorite %>
               <%= link_to({:controller=>:favorite,:action=>:destroy, :id => @favorite.id}, {:method=>:delete, remote: true, class: "btn btn-danger"}) do %>
                  <i class="icon-remove icon-large icon-white"> </i><%= t("favorite.delete") %>
               <% end %>
            <% else %>
               <%= link_to({:controller=>:favorite,:action=>:create, :internship_id => @internship.id, :user_id => current_user.id}, {:method=>:post, remote: true, class: "btn btn-success"}) do %>
                  <i class="icon-heart icon-large icon-white"> </i><%= t("favorite.add") %>
               <% end %>
            <% end %>
         </div>
      </section>
      <!---->
      <section class="attachments">
         <% if @internship.attachments.present? %>
            <b><%= t "internships.attributes.pictures" %> :</b>
            <% @internship.attachments.each do |attachment| %>
               <a href="#myModal" role="button" class="btn" data-toggle="modal">
                  <%= image_tag attachment.file_url(:thumb) %>
               </a>
               <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-header">
                     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                     <h3 id="myModalLabel">Photo Gallery</h3>
                  </div>
                  <div class="modal-body">
                     <%= image_tag attachment.file_url %>
                  </div>
                  <div class="modal-footer"></div>
               </div>
            <% end %>
            <br/>
         <% end %>
         <% if @internship.internship_report.present? %>
            <b><%= t "internships.attributes.internship_report" %> :</b>
            <br/>
            <%= link_to File.basename(@internship.internship_report.path), @internship.internship_report.url %>
            <br/>
         <% end %>
      </section>
      <!---->
      <section class="comments">
         <a class="btn btn-success" id="hide_all"><i class="icon-comments icon-large"></i> <%= @internship.user_comments.size %> <%= @internship.user_comments.size == 1 ? t("comments.singular") : t("comments.plural") %> </a>
         <br/>
         <br/>
         <div id="comment_div">
            <div id="comment_form" style="display:none;">
               <%= form_for(@comment, remote: true ) do |f| %>
                  <div class="field">
                     <%= f.hidden_field :internship_id, value: @internship.id %>
                     <%= f.label t "comments.attributes.body" %>
                     <%= f.text_field :body %>
                     <div class="actions">
                        <%= button_tag(type: 'submit', class: "btn btn-success") do %>
                           <i class="icon-ok icon-white icon-large"></i> <%= t"buttons.save" %>
                        <% end %>
                        <br/>
                        <br/>
                     </div>
                  </div>
               <% end %>
            </div>

            <% @user_comments.each do |i| %>  
               <div class="comment" style="display:none;"> 
                  <div id="user"><%= i.user.name %> 
                     <%= t "helpers.at" %>
                     <%= I18n.localize(i.created_at, :format => :long) %>
                     :
                  </div>
                  <br/>
                  <br/>
                  <div id="sentence">
                     <%= i.body %>
                     <% if current_user.id == i.user_id %>
                        <%= link_to " "+(t "buttons.destroy"),  {:controller => :user_comments, :action => 'destroy', :id => i.id}, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger pull-right delete icon-white icon-remove icon-large", remote: true  %>
                     <% end %>
                  </div>
                  <br/>
               </div>
               <% if i.answer.present? %>
                  <div class="answer" style="display:none;">
                     <div id="user_2"><%= t "answers.from" %>
                        <%= i.answer.user.name %> 
                        <%= t "helpers.at" %>
                        <%= i.answer.created_at.to_formatted_s(:long_ordinal) %>
                        :
                     </div>
                     <br/>
                     <br/>
                     <div id="sentence_2">
                        <%= i.answer.body %>
                        <% if current_user.id == @internship.student.user.id %>
                           <%= link_to " "+(t "buttons.destroy"),  {:controller => :answers, :action => 'destroy', :id => i.answer.id}, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger pull-right delete icon-white icon-remove icon-large", remote: true %>
                        <% end %>
                     </div>
                     <br/>
                  </div>
               <% else %>
                  <% if current_user.id == @internship.student.user.id %>
                     <br />
                     <%= form_for(@answer, remote: true) do |f| %>
                        <div class="answer_2" style="display:none">
                           <div id="answer_field">
                              <div class="field">
                                 <%= f.hidden_field :internship_id, value: @internship.id %>
                                 <%= f.hidden_field :user_comment_id, value: i.id %>
                                 <div id="user_3"><%= f.label t "answers.attributes.body" %></div>
                                 <div id="sentence_3"><%= f.text_field :body %></div>
                                 <div class="actions save_button">
                                    <%= button_tag(type: 'submit', class: "btn btn-success") do %>
                                       <i class="icon-ok icon-white icon-large"></i> <%= t"buttons.save" %>
                                    <% end %>
                                 </div>
                              </div>
                           </div>
                        </div>
                     <% end %>
                  <% end %>
               <% end %>
            <% end %>
         </div>
      </section>
   </section><!-- internDetail end-->
</section><!-- container end -->